<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>oscl_defalloc.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.18 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; <a class="qindex" href="globals.html">Globals</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>oscl_defalloc.h</h1><a href="oscl__defalloc_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">// -*- c++ -*-</span>
00002 <span class="comment">// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =</span>
00003 
00004 <span class="comment">//                     O S C L _ D E F A L L O C</span>
00005 
00006 <span class="comment">// = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =</span>
00007 
00018 <span class="preprocessor">#ifndef OSCL_DEFALLOC_H_INCLUDED</span>
00019 <span class="preprocessor"></span><span class="preprocessor">#define OSCL_DEFALLOC_H_INCLUDED</span>
00020 <span class="preprocessor"></span>
00021 <span class="preprocessor">#ifndef OSCL_BASE_H_INCLUDED</span>
00022 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="oscl__base_8h.html">oscl_base.h</a>"</span>
00023 <span class="preprocessor">#endif</span>
00024 <span class="preprocessor"></span>
<a name="l00025"></a><a class="code" href="group__osclbase.html#a105">00025</a> <span class="preprocessor">#define OSCL_DISABLE_WARNING_TRUNCATE_DEBUG_MESSAGE</span>
00026 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="osclconfig__compiler__warnings_8h.html">osclconfig_compiler_warnings.h</a>"</span>
00027 
00028 <span class="preprocessor">#ifndef OSCL_MEM_INST_H_INCLUDED</span>
00029 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="oscl__mem__inst_8h.html">oscl_mem_inst.h</a>"</span>
00030 <span class="preprocessor">#endif</span>
00031 <span class="preprocessor"></span>
00032 <span class="comment">//A macro for using the Oscl_Alloc or Oscl_DefAlloc call with file name and</span>
00033 <span class="comment">//line number inputs to aid memory auditing.</span>
00034 <span class="preprocessor">#if(PVMEM_INST_LEVEL&gt;0)</span>
<a name="l00035"></a><a class="code" href="group__osclbase.html#a106">00035</a> <span class="preprocessor"></span><span class="preprocessor">#define ALLOCATE(n) allocate_fl(n,__FILE__,__LINE__)</span>
00036 <span class="preprocessor"></span><span class="preprocessor">#else</span>
00037 <span class="preprocessor"></span><span class="preprocessor">#define ALLOCATE(n) allocate(n)</span>
00038 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00039 <span class="preprocessor"></span>
00040 <span class="comment">//A macro for using the Oscl_TAlloc call with file name and line number inputs</span>
00041 <span class="comment">//to aid memory auditing.</span>
00042 <span class="preprocessor">#if(PVMEM_INST_LEVEL&gt;0)</span>
<a name="l00043"></a><a class="code" href="group__osclbase.html#a107">00043</a> <span class="preprocessor"></span><span class="preprocessor">#define ALLOC_AND_CONSTRUCT(n) alloc_and_construct_fl(n,__FILE__,__LINE__)</span>
00044 <span class="preprocessor"></span><span class="preprocessor">#else</span>
00045 <span class="preprocessor"></span><span class="preprocessor">#define ALLOC_AND_CONSTRUCT(n) alloc_and_construct(n)</span>
00046 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00047 <span class="preprocessor"></span>
<a name="l00048"></a><a class="code" href="classOscl__Alloc.html">00048</a> <span class="keyword">class </span><a class="code" href="classOscl__Alloc.html">Oscl_Alloc</a>
00049 {
00050     <span class="keyword">public</span>:
<a name="l00051"></a><a class="code" href="classOscl__Alloc.html#a0">00051</a>         <span class="keyword">virtual</span> <a class="code" href="classOscl__Alloc.html#a0">~Oscl_Alloc</a>() {}
00052         <span class="keyword">virtual</span> <a class="code" href="group__osclbase.html#a27">OsclAny</a>* <a class="code" href="classOscl__Alloc.html#a1">allocate</a>(<span class="keyword">const</span> uint32 size) = 0;
00053 
00054         <span class="comment">//Allocator with file name and line number inputs to aid memory auditing.</span>
00055         <span class="comment">//This call should be used in cases where the allocation will invoke</span>
00056         <span class="comment">//the Oscl memory manager.</span>
00057         <span class="comment">//A default implementation is provided for use with allocators that don't</span>
00058         <span class="comment">//invoke Oscl memory manager.</span>
<a name="l00059"></a><a class="code" href="classOscl__Alloc.html#a2">00059</a>         <span class="keyword">virtual</span> <a class="code" href="group__osclbase.html#a27">OsclAny</a>* <a class="code" href="classOscl__Alloc.html#a2">allocate_fl</a>(<span class="keyword">const</span> uint32 size, <span class="keyword">const</span> <span class="keywordtype">char</span> * file_name, <span class="keyword">const</span> <span class="keywordtype">int</span> line_num)
00060         {
00061             <a class="code" href="group__osclbase.html#a97">OSCL_UNUSED_ARG</a>(file_name);
00062             <a class="code" href="group__osclbase.html#a97">OSCL_UNUSED_ARG</a>(line_num);
00063             <span class="keywordflow">return</span> <a class="code" href="classOscl__Alloc.html#a1">allocate</a>(size);
00064         }
00065 };
00066 
<a name="l00067"></a><a class="code" href="classOscl__Dealloc.html">00067</a> <span class="keyword">class </span><a class="code" href="classOscl__Dealloc.html">Oscl_Dealloc</a>
00068 {
00069     <span class="keyword">public</span>:
00070         <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classOscl__Dealloc.html#a0">deallocate</a>(<a class="code" href="group__osclbase.html#a27">OsclAny</a>* p) = 0;
<a name="l00071"></a><a class="code" href="classOscl__Dealloc.html#a1">00071</a>         <span class="keyword">virtual</span> <a class="code" href="classOscl__Dealloc.html#a1">~Oscl_Dealloc</a>() {}
00072 };
00073 
00074 
<a name="l00075"></a><a class="code" href="classOscl__DefAlloc.html">00075</a> <span class="keyword">class </span><a class="code" href="classOscl__DefAlloc.html">Oscl_DefAlloc</a> : <span class="keyword">public</span> <a class="code" href="classOscl__Alloc.html">Oscl_Alloc</a>, <span class="keyword">public</span> <a class="code" href="classOscl__Dealloc.html">Oscl_Dealloc</a>
00076 {
00077     <span class="keyword">public</span>:
00078         <span class="keyword">virtual</span> <a class="code" href="group__osclbase.html#a27">OsclAny</a>* <a class="code" href="classOscl__DefAlloc.html#a0">allocate</a>(<span class="keyword">const</span> uint32 size) = 0;
00079 
00080         <span class="comment">//Allocator with file name and line number inputs to aid memory auditing.</span>
00081         <span class="comment">//This call should be used in cases where the allocation will invoke</span>
00082         <span class="comment">//the Oscl memory manager.</span>
00083         <span class="comment">//A default implementation is provided for use with allocators that don't</span>
00084         <span class="comment">//invoke Oscl memory manager.</span>
<a name="l00085"></a><a class="code" href="classOscl__DefAlloc.html#a1">00085</a>         <span class="keyword">virtual</span> <a class="code" href="group__osclbase.html#a27">OsclAny</a>* <a class="code" href="classOscl__DefAlloc.html#a1">allocate_fl</a>(<span class="keyword">const</span> uint32 size, <span class="keyword">const</span> <span class="keywordtype">char</span> * file_name, <span class="keyword">const</span> <span class="keywordtype">int</span> line_num)
00086         {
00087             <a class="code" href="group__osclbase.html#a97">OSCL_UNUSED_ARG</a>(file_name);
00088             <a class="code" href="group__osclbase.html#a97">OSCL_UNUSED_ARG</a>(line_num);
00089             <span class="keywordflow">return</span> <a class="code" href="classOscl__DefAlloc.html#a0">allocate</a>(size);
00090         }
00091         <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classOscl__DefAlloc.html#a2">deallocate</a>(<a class="code" href="group__osclbase.html#a27">OsclAny</a>* p) = 0;
00092 };
00093 
00094 
<a name="l00095"></a><a class="code" href="classOsclDestructDealloc.html">00095</a> <span class="keyword">class </span><a class="code" href="classOsclDestructDealloc.html">OsclDestructDealloc</a>
00096 {
00097     <span class="keyword">public</span>:
<a name="l00098"></a><a class="code" href="classOsclDestructDealloc.html#a0">00098</a>         <span class="keyword">virtual</span> <a class="code" href="classOsclDestructDealloc.html#a0">~OsclDestructDealloc</a>() {}
00099         <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classOsclDestructDealloc.html#a1">destruct_and_dealloc</a>(<a class="code" href="group__osclbase.html#a27">OsclAny</a>* ptr) = 0;
00100 };
00101 
<a name="l00102"></a><a class="code" href="classOsclAllocDestructDealloc.html">00102</a> <span class="keyword">class </span><a class="code" href="classOsclAllocDestructDealloc.html">OsclAllocDestructDealloc</a>
00103         : <span class="keyword">public</span> <a class="code" href="classOsclDestructDealloc.html">OsclDestructDealloc</a>, <span class="keyword">public</span> <a class="code" href="classOscl__DefAlloc.html">Oscl_DefAlloc</a>
00104 {
00105 
00106     <span class="keyword">public</span>:
<a name="l00107"></a><a class="code" href="classOsclAllocDestructDealloc.html#a0">00107</a>         <span class="keyword">virtual</span> <a class="code" href="classOsclAllocDestructDealloc.html#a0">~OsclAllocDestructDealloc</a>() {};
00108 };
00109 
00110 <span class="keyword">template</span>&lt;<span class="keyword">class</span> T, <span class="keyword">class</span> Alloc&gt;
<a name="l00111"></a><a class="code" href="classOscl__TAlloc.html">00111</a> <span class="keyword">class </span><a class="code" href="classOscl__TAlloc.html">Oscl_TAlloc</a> : <span class="keyword">public</span> <a class="code" href="classOsclDestructDealloc.html">OsclDestructDealloc</a>
00112 {
00113     <span class="keyword">public</span>:
<a name="l00114"></a><a class="code" href="classOscl__TAlloc.html#s0">00114</a>         <span class="keyword">typedef</span> T           <a class="code" href="classOscl__TAlloc.html#s0">value_type</a>;
<a name="l00115"></a><a class="code" href="classOscl__TAlloc.html#s1">00115</a>         <span class="keyword">typedef</span> T           * <a class="code" href="classOscl__TAlloc.html#s1">pointer</a>;
<a name="l00116"></a><a class="code" href="classOscl__TAlloc.html#s2">00116</a>         <span class="keyword">typedef</span> <span class="keyword">const</span> T     * <a class="code" href="classOscl__TAlloc.html#s2">const_pointer</a>;
<a name="l00117"></a><a class="code" href="classOscl__TAlloc.html#s3">00117</a>         <span class="keyword">typedef</span> uint32      <a class="code" href="classOscl__TAlloc.html#s3">size_type</a>;
<a name="l00118"></a><a class="code" href="classOscl__TAlloc.html#s4">00118</a>         <span class="keyword">typedef</span> T&amp;          <a class="code" href="classOscl__TAlloc.html#s4">reference</a>;
<a name="l00119"></a><a class="code" href="classOscl__TAlloc.html#s5">00119</a>         <span class="keyword">typedef</span> <span class="keyword">const</span> T&amp;    <a class="code" href="classOscl__TAlloc.html#s5">const_reference</a>;
00120 
<a name="l00121"></a><a class="code" href="classOscl__TAlloc.html#a0">00121</a>         <span class="keyword">virtual</span> <a class="code" href="classOscl__TAlloc.html#a0">~Oscl_TAlloc</a>() {};
00122 
00123         <span class="comment">//this is the preferred call-- with file and line number recorded by</span>
00124         <span class="comment">//the caller.  It can be invoked with the ALLOCATE macro.</span>
<a name="l00125"></a><a class="code" href="classOscl__TAlloc.html#a1">00125</a>         <a class="code" href="classOscl__TAlloc.html#s1">pointer</a> <a class="code" href="classOscl__TAlloc.html#a1">allocate_fl</a>(uint32 size , <span class="keyword">const</span> <span class="keywordtype">char</span> * file_name, <span class="keyword">const</span> <span class="keywordtype">int</span> line_num)
00126         {
00127             <a class="code" href="group__osclbase.html#a27">OsclAny</a>* tmp = alloc.allocate_fl(size * <span class="keyword">sizeof</span>(<a class="code" href="classOscl__TAlloc.html#s0">value_type</a>), file_name, line_num);
00128             <span class="keywordflow">return</span> <a class="code" href="group__osclbase.html#a93">OSCL_STATIC_CAST</a>(<a class="code" href="classOscl__TAlloc.html#s1">pointer</a>, tmp);
00129         }
00130 
<a name="l00131"></a><a class="code" href="classOscl__TAlloc.html#a2">00131</a>         <a class="code" href="classOscl__TAlloc.html#s1">pointer</a> <a class="code" href="classOscl__TAlloc.html#a2">allocate</a>(uint32 size)
00132         {
00133             <a class="code" href="group__osclbase.html#a27">OsclAny</a>* tmp = alloc.allocate_fl(size * <span class="keyword">sizeof</span>(<a class="code" href="classOscl__TAlloc.html#s0">value_type</a>), <a class="code" href="group__osclbase.html#a88">NULL</a>, 0);
00134             <span class="keywordflow">return</span> <a class="code" href="group__osclbase.html#a93">OSCL_STATIC_CAST</a>(<a class="code" href="classOscl__TAlloc.html#s1">pointer</a>, tmp);
00135         }
00136 
00137         <span class="comment">//this is the preferred call-- with file and line number recorded by</span>
00138         <span class="comment">//the caller.  It can be invoked by the ALLOC_AND_CONSTRUCT macro.</span>
<a name="l00139"></a><a class="code" href="classOscl__TAlloc.html#a3">00139</a>         <a class="code" href="classOscl__TAlloc.html#s1">pointer</a> <a class="code" href="classOscl__TAlloc.html#a3">alloc_and_construct_fl</a>(<a class="code" href="classOscl__TAlloc.html#s5">const_reference</a> val, <span class="keyword">const</span> <span class="keywordtype">char</span> * file_name, <span class="keyword">const</span> <span class="keywordtype">int</span> line_num)
00140         {
00141             <a class="code" href="group__osclbase.html#a27">OsclAny</a>* tmp = alloc.allocate_fl(<span class="keyword">sizeof</span>(<a class="code" href="classOscl__TAlloc.html#s0">value_type</a>), file_name, line_num);
00142             <a class="code" href="classOscl__TAlloc.html#a10">construct</a>(<a class="code" href="group__osclbase.html#a93">OSCL_STATIC_CAST</a>(<a class="code" href="classOscl__TAlloc.html#s1">pointer</a>, tmp), val);
00143             <span class="keywordflow">return</span> <a class="code" href="group__osclbase.html#a93">OSCL_STATIC_CAST</a>(<a class="code" href="classOscl__TAlloc.html#s1">pointer</a>, tmp);
00144         }
00145 
<a name="l00146"></a><a class="code" href="classOscl__TAlloc.html#a4">00146</a>         <a class="code" href="classOscl__TAlloc.html#s1">pointer</a> <a class="code" href="classOscl__TAlloc.html#a4">alloc_and_construct</a>(<a class="code" href="classOscl__TAlloc.html#s5">const_reference</a> val)
00147         {
00148             <span class="comment">//note: recording file &amp; line # here is not useful-- the caller</span>
00149             <span class="comment">//should provide them.  Just pass zero to aid debugging.</span>
00150             <a class="code" href="group__osclbase.html#a27">OsclAny</a>* tmp = alloc.allocate_fl(<span class="keyword">sizeof</span>(<a class="code" href="classOscl__TAlloc.html#s0">value_type</a>), <a class="code" href="group__osclbase.html#a88">NULL</a>, 0);
00151             <a class="code" href="classOscl__TAlloc.html#a10">construct</a>(<a class="code" href="group__osclbase.html#a93">OSCL_STATIC_CAST</a>(<a class="code" href="classOscl__TAlloc.html#s1">pointer</a>, tmp), val);
00152             <span class="keywordflow">return</span> <a class="code" href="group__osclbase.html#a93">OSCL_STATIC_CAST</a>(<a class="code" href="classOscl__TAlloc.html#s1">pointer</a>, tmp);
00153         }
00154 
<a name="l00155"></a><a class="code" href="classOscl__TAlloc.html#a5">00155</a>         <span class="keywordtype">void</span> <a class="code" href="classOscl__TAlloc.html#a5">deallocate</a>(<a class="code" href="group__osclbase.html#a27">OsclAny</a>* p)
00156         {
00157             alloc.deallocate(p);
00158         }
00159 
<a name="l00160"></a><a class="code" href="classOscl__TAlloc.html#a6">00160</a>         <span class="keywordtype">void</span> <a class="code" href="classOscl__TAlloc.html#a5">deallocate</a>(<a class="code" href="group__osclbase.html#a27">OsclAny</a>* p, <a class="code" href="classOscl__TAlloc.html#s3">size_type</a> n)
00161         {
00162             <a class="code" href="group__osclbase.html#a97">OSCL_UNUSED_ARG</a>(n);
00163             alloc.deallocate(p);
00164         }
00165 
<a name="l00166"></a><a class="code" href="classOscl__TAlloc.html#a7">00166</a>         <span class="keywordtype">void</span> <a class="code" href="classOscl__TAlloc.html#a7">destruct_and_dealloc</a>(<a class="code" href="group__osclbase.html#a27">OsclAny</a>* p)
00167         {
00168             <a class="code" href="classOscl__TAlloc.html#a11">destroy</a>(<a class="code" href="group__osclbase.html#a93">OSCL_STATIC_CAST</a>(<a class="code" href="classOscl__TAlloc.html#s1">pointer</a>, p));
00169             <a class="code" href="classOscl__TAlloc.html#a5">deallocate</a>(p);
00170         }
00171 
<a name="l00172"></a><a class="code" href="classOscl__TAlloc.html#a8">00172</a>         <a class="code" href="classOscl__TAlloc.html#s1">pointer</a> <a class="code" href="classOscl__TAlloc.html#a8">address</a>(<a class="code" href="classOscl__TAlloc.html#s4">reference</a> r)
00173         {
00174             <span class="keywordflow">return</span> &amp;r;
00175         }
<a name="l00176"></a><a class="code" href="classOscl__TAlloc.html#a9">00176</a>         <a class="code" href="classOscl__TAlloc.html#s2">const_pointer</a> <a class="code" href="classOscl__TAlloc.html#a8">address</a>(<a class="code" href="classOscl__TAlloc.html#s5">const_reference</a> r)<span class="keyword"> const</span>
00177 <span class="keyword">        </span>{
00178             <span class="keywordflow">return</span> &amp;r;
00179         }
00180 
<a name="l00181"></a><a class="code" href="classOscl__TAlloc.html#a10">00181</a>         <span class="keywordtype">void</span> <a class="code" href="classOscl__TAlloc.html#a10">construct</a>(<a class="code" href="classOscl__TAlloc.html#s1">pointer</a> p, <a class="code" href="classOscl__TAlloc.html#s5">const_reference</a> val)
00182         {
00183             <span class="keyword">new</span>(p) T(val);
00184         }
<a name="l00185"></a><a class="code" href="classOscl__TAlloc.html#a11">00185</a>         <span class="keywordtype">void</span> <a class="code" href="classOscl__TAlloc.html#a11">destroy</a>(<a class="code" href="classOscl__TAlloc.html#s1">pointer</a> p)
00186         {
00187             <a class="code" href="group__osclbase.html#a97">OSCL_UNUSED_ARG</a>(p);
00188             p-&gt;~T();
00189         }
00190 
00191         <span class="keyword">template</span> &lt;<span class="keyword">class</span> U, <span class="keyword">class</span> V&gt;
<a name="l00192"></a><a class="code" href="structOscl__TAlloc_1_1rebind.html">00192</a>         <span class="keyword">struct </span><a class="code" href="structOscl__TAlloc_1_1rebind.html">rebind</a>
00193         {
<a name="l00194"></a><a class="code" href="structOscl__TAlloc_1_1rebind.html#s0">00194</a>             <span class="keyword">typedef</span> <a class="code" href="classOscl__TAlloc.html">Oscl_TAlloc&lt;U, V&gt;</a> <a class="code" href="classOscl__TAlloc.html">other</a>;
00195         };
00196 
00197     <span class="keyword">private</span>:
00198         Alloc alloc;
00199 };
00200 
00201 
00204 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><img src="pvlogo_small.jpg"><address style="align: right;"><small>OSCL API</small>
<address style="align: left;"><small>Posting Version: CORE_8.504.1.1 </small>
</small></address>
</body>
</html>
